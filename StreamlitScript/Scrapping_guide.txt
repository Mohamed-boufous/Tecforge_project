####################################################################
# GUIDE D'INSTALLATION COMPLET POUR UBUNTU (Version Corrigée)
####################################################################

---
# ÉTAPE 1 : PRÉPARATION DU SYSTÈME
---

# 1.1 - Ouvrez le Terminal.

# 1.2 - Mettez à jour votre système.
sudo apt update && sudo apt upgrade -y

# 1.3 - Installez tous les logiciels et outils nécessaires.
sudo apt install python3-pip python3-venv git tesseract-ocr tesseract-ocr-fra poppler-utils libreoffice docker.io docker-compose -y

---
# ÉTAPE 2 : LANCEMENT DE LA BASE DE DONNÉES WEAVIATE
---

# Cette étape suppose que votre fichier `docker-compose.yml` existe
# déjà dans votre dossier de projet.

# 2.1 - Démarrez le service Weaviate en arrière-plan.
# (Assurez-vous d'être dans le dossier contenant le fichier docker-compose.yml)
sudo docker-compose up -d

# 2.2 - (Optionnel) Vérifiez que le service est bien lancé.
sudo docker-compose ps
# (Vous devriez voir un service "weaviate" avec l'état "Up" ou "running").

---
# ÉTAPE 3 : CONFIGURATION DU PROJET PYTHON
---

# 3.1 - Clonez votre projet depuis GitHub (si ce n'est pas déjà fait).
# git clone [URL_DE_VOTRE_PROJET]
# cd [NOM_DE_VOTRE_PROJET]

# 3.2 - Créez et activez l'environnement virtuel.
python3 -m venv env
source env/bin/activate
# (Votre terminal doit maintenant afficher "(env)" au début de la ligne).

# 3.3 - Créez le fichier requirements.txt.
# Copiez et collez l'intégralité de ce bloc dans le terminal.
cat > requirements.txt << EOL
####################################################################
# Dépendances pour les projets avec version CPU de PyTorch
####################################################################

# -- Instructions spéciales pour forcer la version CPU de PyTorch --
--index-url https://download.pytorch.org/whl/cpu
--extra-index-url https://pypi.org/simple

# --- Paquets PyTorch ---
torch
torchvision
torchaudio

# --- Framework de l'application Web ---
streamlit

# --- Bases de données ---
weaviate-client
pymongo

# --- Intelligence Artificielle et Traitement du Langage ---
sentence-transformers

# --- Traitement de Documents et Fichiers ---
pandas
openpyxl
python-docx
pypdf
pdf2image
Pillow
pytesseract

# --- Web Scraping ---
selenium
webdriver-manager
beautifulsoup4

# --- Utilitaires ---
python-dotenv
EOL

# 3.4 - Installez toutes les bibliothèques Python.
pip install -r requirements.txt

# 3.5 - Modifiez le script Streamlit (TRÈS IMPORTANT).
# NOTE : Il y a TROIS modifications à faire pour que le script soit compatible et à jour.
# Remplacez "votre_app_streamlit.py" par le vrai nom du fichier.
gedit votre_app_streamlit.py

# -- MODIFICATION 1 : Commentez les chemins Windows --
# Au début du fichier, trouvez et commentez (ajoutez un # au début) ces deux lignes :
# pytesseract.pytesseract.tesseract_cmd = r'C:\...'
# POPPLER_PATH = r"C:\..."

# -- MODIFICATION 2 : Corrigez la fonction d'OCR pour PDF --
# Trouvez la fonction "extraire_texte_images_pdf_ocr" et modifiez la ligne à l'intérieur :
# ANCIENNE LIGNE : images = convert_from_path(chemin_fichier, poppler_path=POPPLER_PATH)
# NOUVELLE LIGNE : images = convert_from_path(chemin_fichier)

# -- MODIFICATION 3 : Corrigez la configuration de Weaviate --
# Trouvez la fonction "telecharger_et_indexer_dossier" et modifiez la création de la collection :
# ANCIENNE LIGNE : vectorizer_config=wvc.Configure.Vectorizer.none()
# NOUVELLE LIGNE : vector_config=wvc.Configure.VectorConfig.none()

# Enregistrez le fichier et fermez l'éditeur.

# 3.6 - Créez le fichier .env pour votre clé de base de données.
# Remplacez le texte par votre vraie clé MongoDB.
echo 'MONGO2_URI="VOTRE_CLE_MONGO_DB_ATLAS_ICI"' > .env

---
# ÉTAPE 4 : EXÉCUTION DES SCRIPTS
---

# 4.1 - Pour lancer l'application Streamlit.
# (Assurez-vous que "(env)" est activé).
# Remplacez "votre_app_streamlit.py" par le vrai nom du fichier.
streamlit run votre_app_streamlit.py
# (Ouvrez votre navigateur web à l'adresse http://localhost:8501)

# 4.2 - Pour lancer le script de Scraping.
# (Assurez-vous que "(env)" est activé et que vous êtes dans le bon dossier).
# Remplacez "Scrapping.py" par le vrai nom du fichier.
python Scrapping.py